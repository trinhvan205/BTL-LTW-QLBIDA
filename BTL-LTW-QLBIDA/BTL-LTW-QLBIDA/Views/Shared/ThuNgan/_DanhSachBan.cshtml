@model List<BTL_LTW_QLBIDA.Models.Ban>
<link rel="icon" type="image/x-icon" href="~/logo.png" />
<div class="grid-container">
    <!-- GRID BÀN -->
    <div class="ban-grid" id="banGrid">
        @if (Model != null && Model.Any())
        {
            foreach (var ban in Model)
            {
                var trangThaiClass = ban.Trangthai == true ? "dang-choi" : "trong";
                var phienChoi = ban.Phienchois.FirstOrDefault(p => p.Gioketthuc == null);

                <div class="ban-item @trangThaiClass"
                     data-id="@ban.Idban"
                     data-ten="@ban.Idban"
                     data-trangthai="@ban.Trangthai">
                    <div class="ban-icon">🎱</div>
                    <div class="ban-name">@ban.Idban</div>
                    <div class="ban-price">@((ban.Giatien ?? 0).ToString("N0"))đ/giờ</div>

                    @if (ban.Trangthai == true && phienChoi != null)
                    {
                        var gioChoi = DateTime.Now - (phienChoi.Giobatdau ?? DateTime.Now);
                        <div class="ban-time">@((int)gioChoi.TotalHours)h @(gioChoi.Minutes)m</div>
                    }
                    else
                    {
                        <div style="min-height: 22px; margin-top: 4px;"></div>
                    }
                </div>
            }
        }
        else
        {
            <div class="col-12 text-center py-5">
                <i class="bi bi-inbox" style="font-size: 48px; color: #ccc;"></i>
                <p class="text-muted mt-2">Không có bàn nào</p>
            </div>
        }
    </div>

    <!-- PAGINATION - BÊN NGOÀI GRID -->
    <div class="pagination-controls" id="banPagination" style="display: none;">
        <button type="button" class="pagination-btn" id="banPrevBtn">
            <i class="bi bi-chevron-left"></i>
        </button>
        <span class="pagination-info" id="banPageInfo">1/1</span>
        <button type="button" class="pagination-btn" id="banNextBtn">
            <i class="bi bi-chevron-right"></i>
        </button>
    </div>
</div>

<script>
    (function() {
        const itemsPerPage = 18;
        const items = document.querySelectorAll('#banGrid .ban-item');
        const totalPages = Math.ceil(items.length / itemsPerPage);
        let currentPage = 1;

        const pagination = document.getElementById('banPagination');
        const pageInfo = document.getElementById('banPageInfo');
        const prevBtn = document.getElementById('banPrevBtn');
        const nextBtn = document.getElementById('banNextBtn');

        if (totalPages > 1) {
            pagination.style.display = 'flex';
        }

        function showPage(page) {
            items.forEach((item, index) => {
                const start = (page - 1) * itemsPerPage;
                const end = start + itemsPerPage;
                item.style.display = (index >= start && index < end) ? 'flex' : 'none';
            });

            pageInfo.textContent = `${page}/${totalPages}`;
            prevBtn.disabled = (page === 1);
            nextBtn.disabled = (page === totalPages);
            currentPage = page;
        }

        prevBtn.addEventListener('click', () => {
            if (currentPage > 1) showPage(currentPage - 1);
        });

        nextBtn.addEventListener('click', () => {
            if (currentPage < totalPages) showPage(currentPage + 1);
        });

        showPage(1);
    })();
</script>